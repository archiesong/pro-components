"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const S=require("vue"),x=require("ant-design-vue/lib/table/hooks/useLazyKVMap"),C=require("ant-design-vue/lib/_util/hooks/useMergedState"),q=require("../useState/index.js"),I=require("../useMemo/index.js"),N=require("../useEffect/index.js"),E=require("../usePrevious/index.js"),y=e=>Array.isArray(e)?e.join(","):e;function A(e,s){var o;const{getRowKey:w,row:_,data:R,childrenColumnName:m="children"}=e,r=(o=y(e.key))==null?void 0:o.toString(),f=new Map;function K(d,t,c){d.forEach((n,l)=>{const a=(c||0)*10+l,i=w(n,a).toString();n&&typeof n=="object"&&m in n&&K(n[m]||[],i,a);const u={...n,map_row_key:i,children:void 0,map_row_parentKey:t};delete u.children,t||delete u.map_row_parentKey,f.set(i,u)})}return s==="top"&&f.set(r,{...f.get(r),..._}),K(R),s==="update"&&f.set(r,{...f.get(r),..._}),s==="delete"&&f.delete(r),(d=>{const t=new Map,c=[],n=(l=!1)=>{d.forEach(a=>{var i;if(a.map_row_parentKey&&!a.map_row_key){const{map_row_parentKey:u,...g}=a;t.has(u)||t.set(u,[]),l&&((i=t.get(u))==null||i.push(g))}})};return n(s==="top"),d.forEach(l=>{var a;if(l.map_row_parentKey&&l.map_row_key){const{map_row_parentKey:i,map_row_key:u,...g}=l;t.has(u)&&(g[m]=t.get(u)),t.has(i)||t.set(i,[]),(a=t.get(i))==null||a.push(g)}}),n(s==="update"),d.forEach(l=>{if(!l.map_row_parentKey){const{map_row_key:a,...i}=l;if(a&&t.has(a)){const u={...i,[m]:t.get(a)};c.push(u);return}c.push(i)}}),c})(f)}const j=e=>{const[s]=q.default(void 0),w=()=>{const o=new Map,d=(t,c)=>{t==null||t.forEach((n,l)=>{var i;const a=c==null?l.toString():c+"_"+l.toString();o.set(a,y(e.getRowKey.value(n,-1))),o.set((i=y(e.getRowKey.value(n,-1)))==null?void 0:i.toString(),a),e.childrenColumnName&&(n!=null&&n[e.childrenColumnName])&&d(n[e.childrenColumnName],a)})};return d(e.dataSource.value),o},_=I.default(()=>w(),[]),R=S.ref(_.value);N.default(()=>{R.value=w()},[()=>e.dataSource.value]);const[m]=x(e.dataSource,S.ref("children"),e.getRowKey),[r,f]=C([],{value:S.computed(()=>e.editableKeys),onChange:e.onChange?o=>{var d;(d=e==null?void 0:e.onChange)==null||d.call(e,(o==null?void 0:o.filter(t=>t!==void 0))??[],(o==null?void 0:o.map(t=>m(t)).filter(t=>t!==void 0))??[])}:void 0}),K=E.default(r);return{editableKeys:r,setEditableRowKeys:f,isEditable:o=>{var a,i,u,g,v,M;const d=(i=(a=e.getRowKey.value(o,o.index))==null?void 0:a.toString)==null?void 0:i.call(a),t=(g=(u=e.getRowKey.value(o,-1))==null?void 0:u.toString)==null?void 0:g.call(u),c=(v=r.value)==null?void 0:v.map(h=>h==null?void 0:h.toString()),n=((M=K.value)==null?void 0:M.map(h=>h==null?void 0:h.toString()))||[],l=e.tableName&&!!(n!=null&&n.includes(t))||!!(n!=null&&n.includes(d));return{recordKey:t,isEditable:e.tableName&&(c==null?void 0:c.includes(t))||(c==null?void 0:c.includes(d)),preIsEditable:l}},newLineRecord:s,getRealIndex:e.getRealIndex}};exports.default=j;exports.editableRowByKey=A;exports.recordKeyToString=y;
